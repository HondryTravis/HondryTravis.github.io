<!doctype html>
<html class="docs-version-current" lang="zh-Hans" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="TRAVIS RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="TRAVIS Atom Feed"><title data-react-helmet="true">JS | 执行调度过程 | TRAVIS</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://hondrytravis.github.io//docs/typescript/javascript_workflow"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-Hans"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="JS | 执行调度过程 | TRAVIS"><meta data-react-helmet="true" name="description" content="当Javascript代码执⾏的时候会将不同的变量存于内存中的不同位置：堆（heap）和栈（stack）中来加以区分。其中，堆⾥存放着⼀些对象。⽽栈中则存放着⼀些基础类型变量以及对象的指针"><meta data-react-helmet="true" property="og:description" content="当Javascript代码执⾏的时候会将不同的变量存于内存中的不同位置：堆（heap）和栈（stack）中来加以区分。其中，堆⾥存放着⼀些对象。⽽栈中则存放着⼀些基础类型变量以及对象的指针"><link data-react-helmet="true" rel="shortcut icon" href="/images/default/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hondrytravis.github.io//docs/typescript/javascript_workflow"><link data-react-helmet="true" rel="alternate" href="https://hondrytravis.github.io//docs/typescript/javascript_workflow" hreflang="zh-Hans"><link data-react-helmet="true" rel="alternate" href="https://hondrytravis.github.io//docs/typescript/javascript_workflow" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.673bc2ec.css">
<link rel="preload" href="/assets/js/runtime~main.261a0b30.js" as="script">
<link rel="preload" href="/assets/js/main.d8aec2c2.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar--dark navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/default/Logo.png" alt="logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/default/Logo.png" alt="logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Better Late Than Never</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">博客</a><a class="navbar__item navbar__link" href="/algorithm/">算法</a><a class="navbar__item navbar__link" href="/open_source/"> 开源贡献</a><a class="navbar__item navbar__link" href="/blog">阅读</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/HondryTravis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/images/default/Logo.png" alt="logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/default/Logo.png" alt="logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>Better Late Than Never</b></a><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">博客</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Typescript</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/typescript/ts_utility_types">TS | 内置实用类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/typescript/ts_operator">TS | 特殊操作符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/typescript/implement_list">JS | 手写系列</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/typescript/javascript_high">JS | 高阶方法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/typescript/recursive_optimization">JS | 函数递归优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/typescript/javascript_workflow">JS | 执行调度过程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/typescript/u_dont_know_js">JS | 你知道的JS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/typescript/js_packing_unboxing">JS | 装箱和拆箱</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Wasm</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTML | CSS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Webpack</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Node</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">前端工程化</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">性能优化</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Framework</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">OS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">编程思想</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HTTP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Nginx</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Java</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Python</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">数据库</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">其他常用工具</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>JS | 执行调度过程</h1></header><p>当Javascript代码执⾏的时候会将不同的变量存于内存中的不同位置：堆（heap）和栈（stack）中来加以区分。其中，堆⾥存放着⼀些对象。⽽栈中则存放着⼀些基础类型变量以及对象的指针</p><p>js 在执⾏可执⾏的脚本时，⾸先会创建⼀个全局可执⾏上下⽂ globalContext，每当执⾏到⼀个函数调⽤时都会创建⼀个可执⾏上下⽂（execution context）EC。当然可执⾏程序可能会存在很多函数调⽤，那么就会创建很多EC，所以 JavaScript 引擎创建了执⾏上下⽂栈（Execution context stack，ECS）来管理执⾏上下⽂。当函数调⽤完成，js会退出这个执⾏环境并把这个执⾏环境销毁，回到上⼀个⽅法的执⾏环境... 这个过程反复进⾏，直到执⾏栈中的代码全部执⾏完毕，如下是以上的⼏个关键词，了解一下。</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="关键词">关键词<a aria-hidden="true" class="hash-link" href="#关键词" title="标题的直接链接">​</a></h2><ul><li><p>执⾏栈（Execution Context Stack）</p></li><li><p>全局对象（GO Global Context）(因为垃圾回收叫 GC,所以简单成为 GO)</p></li><li><p>活动对象（Activation Object）</p></li><li><p>变量对象（Variable Object）</p></li><li><p>全局上下⽂(GC global execution context )</p></li><li><p>执⾏上下⽂（EC execution context）</p></li><li><p>函数调⽤栈（Callee Stack)</p></li><li><p>执⾏上下⽂栈（ECS execution context Stack )</p></li><li><p>垃圾回收（GC Garbage Collection ）</p></li><li><p>新版本ES5+</p><ul><li>词法环境（LexicalEnvironment）</li><li>变量环境（VariableEnvironment）</li><li>环境记录（Environment record）</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="执栈">执⾏栈<a aria-hidden="true" class="hash-link" href="#执栈" title="标题的直接链接">​</a></h2><p><img alt="javascript_workfolw" src="/assets/images/javascript_workflow-91249281e37222c08da5320574487363.jpeg"></p><p>执行栈，在其他编程语言中也被称为调用栈，它是一种LIFO（后进先出）的结构，被用于在代码执行阶段存储所有创建过的执行环境。</p><p>当Javascript引擎首次运行到你的脚本时，它会创建一个全局执行环境，并把它推入到当前的执行栈中。每当引擎运行到其函数调用时，就会为这个函数创建一个新的执行环境(栈帧)，并把它推入到堆栈的顶部。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token maybe-class-name" style="color:#00bfff">ECStack</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token spread operator" style="color:#FF69B4">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  globalContext</span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">]</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>引擎会执行其执行环境位于堆栈顶部的函数。当函数执行完毕时，当前执行栈会从堆栈中弹出去，并且控件将会到达其在当前堆栈下面的那个执行环境中。如果函数内再调⽤其他函数，相同的步骤将会再次发⽣：创建⼀个新的 EC 之后把 EC 推⼊执⾏栈。⼀旦⼀个 EC 执⾏完成，变回从执⾏栈中推出（pop）。ESP指针负责EC出栈指向。</p><p>浏览器解释器执⾏ js 是单线程的过程，这就意味着同⼀时间，只能有⼀个事情在进⾏。其他的活动和事件只能排队等候，⽣成出⼀个等候队列执⾏栈（Execution Stack）。</p><p>第一种方法</p><p>通过抛出异常</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">fun3</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token console class-name" style="color:#00bfff">console</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token method function property-access" style="color:#8BE9FD">log</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token string" style="color:#C3E88D">&#x27;fun3&#x27;</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#FF69B4">throw</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&#x27;env&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">fun2</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> test </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token function" style="color:#00E673">fun3</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token console class-name" style="color:#00bfff">console</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token method function property-access" style="color:#8BE9FD">log</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token plain">test</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">fun1</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token function" style="color:#00E673">fun2</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">fun1</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>我们可以简单的查看到当前函数的执行调度过程</p><p>第二种方法</p><p>我们可以做个小测试，直接追加 <code>debugger</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">fun3</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token console class-name" style="color:#00bfff">console</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token method function property-access" style="color:#8BE9FD">log</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token string" style="color:#C3E88D">&#x27;fun3&#x27;</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">fun2</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token function" style="color:#00E673">fun3</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">fun1</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">debugger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token function" style="color:#00E673">fun2</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">fun1</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">//执⾏fun1 结果如下</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token maybe-class-name" style="color:#00bfff">ECStack</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  fun1</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  globalContext</span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">]</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>可以方便的在浏览器测试 <img alt="js01" src="/assets/images/js02-2f00bfe61c18c65948dcd4c07792b5f3.png"></p><p>我们按住 command + ; 继续向下走，会依次 fun2 --&gt; fun3 --&gt; fun2 ---&gt; fun1 --&gt; anonymous(globalContext)</p><p>分别依次可以在上边的 Scope 选项中查看到当前执行栈的 this 指向 Local, 所以可以方便维护当前的执行上下文</p><p><img alt="js01" src="/assets/images/js03-b6be89a02ddfe1369f7284e6a6cb10d3.png"></p><p><strong>函数的执行栈是有大小的</strong>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">foo1</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token function" style="color:#00E673">foo1</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">foo1</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// Uncaught RangeError: Maximum call stack size exceeded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">let</span><span class="token plain"> m </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">foo</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#FF69B4">if</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token plain">m</span><span class="token operator" style="color:#FF69B4">++</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">1000</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token keyword" style="color:#FF69B4">debugger</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token function" style="color:#00E673">foo</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">foo</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// 就会发现调用栈中存在 1000 个调用 EC(栈帧)</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p><img alt="js04" src="/assets/images/js04-779bdcca312c6b30b8c6e988164e292e.png"></p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="全局对象">全局对象<a aria-hidden="true" class="hash-link" href="#全局对象" title="标题的直接链接">​</a></h2><p>Javascript引擎首次运行到你的脚本时，它会创建一个全局执行环境, 这个环节就是 GO(Global Context)</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="变量对象">变量对象<a aria-hidden="true" class="hash-link" href="#变量对象" title="标题的直接链接">​</a></h2><p>变量对象VO是与执⾏上下⽂相关的特殊对象,⽤来存储上下⽂的函数声明，函数形参和变量。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> a </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">10</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">test</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token parameter" style="color:#FFB86C">x</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> b </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">20</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">test</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token number" style="color:#BD93F9">30</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>全局上下⽂的变量对象 VO</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token comment" style="color:#737373">// 全局上下⽂的变量对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token constant" style="color:#BD93F9">VO</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token plain">globalContext</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  a</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">10</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  test</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain">reference to </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>test函数上下⽂的变量对象 VO</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token comment" style="color:#737373">// test函数上下⽂的变量对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token constant" style="color:#BD93F9">VO</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token plain">test functionContext</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  x</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">30</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  b</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token constant" style="color:#BD93F9">VO</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token plain">globalContext</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">===</span><span class="token plain"> global</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p style="color:red">VO分为 全局上下⽂的变量对象VO，函数上下⽂的变量对象VO</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="活动对象">活动对象<a aria-hidden="true" class="hash-link" href="#活动对象" title="标题的直接链接">​</a></h2><p>在函数上下⽂中，变量对象被表示为活动对象 AO, 当函数被调⽤后，这个特殊的活动对象就被创建了。它包含普通参数与特殊参数对象（具有索引属性的参数映射表）。活动对象在函数上下⽂中作为变量对象使⽤, 此阶段也将发生预编译</p><ol><li>在函数执⾏上下⽂中，VO是不能直接访问的，此时由活动对象扮演VO的⻆⾊。</li><li>Arguments对象它包括如下属性：callee 、length</li><li>内部定义的函数</li><li>以及绑定上对应的变量环境；</li><li>内部定义的变量</li></ol><p style="color:red">VO(functionContext) === AO</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">test</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token parameter" style="color:#FFB86C">a</span><span class="token parameter punctuation" style="color:#FF69B4">,</span><span class="token parameter" style="color:#FFB86C"> b</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> c </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">10</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">d</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> </span><span class="token function-variable function" style="color:#00E673">e</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">_e</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">x</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">test</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token number" style="color:#BD93F9">10</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"> </span><span class="token comment" style="color:#737373">// call</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>当进⼊带有参数10的test函数上下⽂时，AO表现为如下</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token constant" style="color:#BD93F9">AO</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token plain">test</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  a</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">10</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  b</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#FF69B4">undefined</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  c</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#FF69B4">undefined</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  d</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain">reference to </span><span class="token maybe-class-name" style="color:#00bfff">FunctionDeclaration</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&quot;d&quot;</span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  e</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#FF69B4">undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><blockquote><p>AO⾥并不包含函数“x”。这是因为“x” 是⼀个函数表达式(FunctionExpression, 缩写为 FE) ⽽不是函数声明,函数表达式不会影响VO</p></blockquote><p>活动对象和变量对象的区别:</p><ul><li>变量对象（VO）是规范上或者是 JS 引擎上实现的,并不能在 JS 环境中直接访问</li><li>当进入到一个执行上下文后,这个变量对象才会被激活,所以叫活动对象(AO),这时候活动对象上的各种属性才能被访问,因为被激活了</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="深度活动对象">深度活动对象<a aria-hidden="true" class="hash-link" href="#深度活动对象" title="标题的直接链接">​</a></h2><p>深度活动对象(Activation Object) 分为 <strong>创建阶段</strong> 和 <strong>执⾏阶段</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">foo</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token parameter" style="color:#FFB86C">i</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> a </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&#x27;hello&#x27;</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> </span><span class="token function-variable function" style="color:#00E673">b</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">privateB</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">c</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">foo</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token number" style="color:#BD93F9">22</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>当我们执⾏foo(22)的时候，EC创建阶段会类似⽣成下⾯这样的对象：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token comment" style="color:#737373">/* 创建阶段 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// 在创建阶段，会发⽣属性名称的定义，但是并没有赋值(变量提升阶段)。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">fooExecutionContext </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  scopeChain</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:#00bfff">Scope</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token constant" style="color:#BD93F9">AO</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    arguments</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token number" style="color:#BD93F9">0</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">22</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      length</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    i</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">22</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    c</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> pointer to </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">c</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    a</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#FF69B4">undefined</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    b</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#FF69B4">undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token constant" style="color:#BD93F9">VO</span><span class="token operator" style="color:#FF69B4">:</span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">Scope</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">[</span><span class="token constant" style="color:#BD93F9">AO</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"> globalContext</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token constant" style="color:#BD93F9">VO</span><span class="token punctuation" style="color:#FF69B4">]</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// 形参 i 这时候已经有赋值了，但是变量还是 undefined, 只是初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">/* 执行阶段 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// ⼀旦创建阶段（creationstage）结束，变进⼊了激活 / 执⾏阶段</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// 那么 fooExecutionContext 便会完成赋值，变成这样：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">//【 运⾏函数内部的代码，对变量复制，代码⼀⾏⼀⾏的被解释执⾏ 】</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">fooExecutionContext </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  scopeChain</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#FF69B4">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token constant" style="color:#BD93F9">AO</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    arguments</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token number" style="color:#BD93F9">0</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">22</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      length</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    i</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">22</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    c</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> pointer to </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">c</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    a</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&#x27;hello&#x27;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    b</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> pointer to </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">privateB</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token constant" style="color:#BD93F9">VO</span><span class="token operator" style="color:#FF69B4">:</span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">Scope</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">[</span><span class="token constant" style="color:#BD93F9">AO</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"> globalContext</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token constant" style="color:#BD93F9">VO</span><span class="token punctuation" style="color:#FF69B4">]</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">this</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token comment" style="color:#737373">//{ 运⾏时确认 }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>看个图</p><p><a href="https://www.zhihu.com/zvideo/1314911698281725952" target="_blank" rel="noopener noreferrer">通过动图了解JS中的ECStack、EC、VO 和 AO</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="补充活动对象">补充活动对象<a aria-hidden="true" class="hash-link" href="#补充活动对象" title="标题的直接链接">​</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> x </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">10</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">foo</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> barFn </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#00bfff">Function</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token string" style="color:#C3E88D">&#x27;alert(x); alert(y);&#x27;</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token function" style="color:#00E673">barFn</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"> </span><span class="token comment" style="color:#737373">// 10, &quot;y&quot; is not defined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token function" style="color:#00E673">foo</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><blockquote><ul><li>通过函构造函数创建的函数的[<!-- -->[scope]<!-- -->]属性总是唯⼀的全局对象（LexicalEnvironment）。</li><li>Eval code - eval 函数包含的代码块也有同样的效果</li></ul></blockquote><p style="color:red">VO 函数上下⽂的链接 AO 是函数⾃身的</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token comment" style="color:#737373">// 所以关于 fun 那个例子</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token maybe-class-name" style="color:#00bfff">ECStack</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  fun3</span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  fun2</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  fun1</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  globalContext</span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">]</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="发生异步">发生异步<a aria-hidden="true" class="hash-link" href="#发生异步" title="标题的直接链接">​</a></h2><p>上述都是在同步的情况下完成的，如果出现异步，或者 ajax 的情况下是如何呢</p><p>事件队列Task Queue</p><p>当js引擎遇到⼀个异步事件后，其实不会说⼀直等到异步事件的返回，⽽是先将异步事件进⾏挂起。等到异步事件执⾏完毕后，会被加⼊到事件队列中。（注意，此时只是异步事件执⾏完成，其中的回调函数并没有去执⾏。）当执⾏队列执⾏完毕，主线程处于闲置状态时，会去异步队列那抽取最先被推⼊队列中的异步事件，放⼊执⾏栈中，执⾏其中的回调同步代码。如此反复，这样就形成了⼀个⽆限的循环。这就是这个过程被称为 “事件循环（EventLoop）”的原因。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">test</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> result </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">[</span><span class="token punctuation" style="color:#FF69B4">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#FF69B4">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> i </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">0</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"> i </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">10</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"> i</span><span class="token operator" style="color:#FF69B4">++</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      result</span><span class="token punctuation" style="color:#FF69B4">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#FF69B4">]</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#FF69B4">return</span><span class="token plain"> i</span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#FF69B4">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">let</span><span class="token plain"> r </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token function" style="color:#00E673">test</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">r</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token method function property-access" style="color:#8BE9FD">forEach</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token parameter" style="color:#FFB86C">fn</span><span class="token plain"> </span><span class="token arrow operator" style="color:#FF69B4">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token console class-name" style="color:#00bfff">console</span><span class="token punctuation" style="color:#FF69B4">.</span><span class="token method function property-access" style="color:#8BE9FD">log</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token string" style="color:#C3E88D">&#x27;fn&#x27;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token function" style="color:#00E673">fn</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><ol><li>函数test执⾏完出栈 留下AO(test)有个i的指向</li><li>函数在执⾏的时候，函数的执⾏环境才会⽣成。所以fn执⾏的时候⽣成作⽤域链条指向如下</li><li>AO(result<!-- -->[i]<!-- -->) --&gt; AO(fn) --&gt; VO(G) 加个闭包就⽴⻢创建了执⾏环境</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>闭包 | this | 作用域连 | eval不能回收 | 异步队列</h5></div><div class="admonition-content"><p>那么其实⼀切也就迎刃⽽解了。</p><p><strong>闭包</strong>: 原理是 Scope (堆空间中存储 closure(foo))</p><p><strong>this</strong>: 动态绑定，也指向当前执行栈 ECS(Execution Context Stack) 顶的执行上下文 EC(Execution Context)</p><p><strong>作用域连</strong>: 原理是Scope: <!-- -->[AO, globalContext.VO]</p><p><strong>eval不能回收</strong>: 原理是推不进AO, 变量提升的原理是 AO 的准备阶段</p><p><strong>异步队列</strong>: 原理是 ECS</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="新版本-es5">新版本 ES5+<a aria-hidden="true" class="hash-link" href="#新版本-es5" title="标题的直接链接">​</a></h2><p>JS执行上下文的创建阶段主要负责三件事:</p><ol><li><p>this 值的决定，也被称为 This Binding。（即 this 绑定）</p></li><li><p>LexicalEnvironment（词法环境）</p></li><li><p>VariableEnvironment（变量环境）</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token maybe-class-name" style="color:#00bfff">ExecutionContext</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">ThisBinding</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token keyword" style="color:#FF69B4">this</span><span class="token plain"> value</span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">LexicalEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#FF69B4">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">VariableEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#FF69B4">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="确定thisbinding">确定ThisBinding<a aria-hidden="true" class="hash-link" href="#确定thisbinding" title="标题的直接链接">​</a></h3><p>官方的称呼为 This Binding,在全局执行上下文中，this 总是指向全局对象，例如浏览器环境下 this 指向 window 对象。而在 nodejs 中指向这个文件的 module 对象。</p><p>在函数执行上下文中,this的值取决于函数的调用方式，this 的值取决于函数的调用方式。具体有：默认绑定、隐式绑定、显式绑定（硬绑定）、new绑定、箭头函数</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="词法环境">词法环境<a aria-hidden="true" class="hash-link" href="#词法环境" title="标题的直接链接">​</a></h3><p><a href="https://tc39.es/ecma262" target="_blank" rel="noopener noreferrer">具体词法环境参考 9.1 Environment Records</a></p><p>词法环境就是描述环境的对象，主要包含两个部分:</p><ul><li>环境记录(Environment Record) 记录相应环境中的形参，函数声明，变量声明等</li><li>对外部环境的引用(out reference)</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token comment" style="color:#737373">// 全局执⾏上下⽂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token maybe-class-name" style="color:#00bfff">GlobalExectionContext</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token comment" style="color:#737373">// 词法环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">LexicalEnvironment</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token comment" style="color:#737373">// 环境记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token maybe-class-name" style="color:#00bfff">EnvironmentRecord</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token maybe-class-name" style="color:#00bfff">Type</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&quot;Object&quot;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"> </span><span class="token comment" style="color:#737373">// 全局环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token comment" style="color:#737373">// ... 标识符绑定在这⾥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      outer</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token keyword null nil" style="color:#FF69B4">null</span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"> </span><span class="token comment" style="color:#737373">// 对外部环境的引⽤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// 函数执⾏上下⽂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token maybe-class-name" style="color:#00bfff">FunctionExectionContext</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">LexicalEnvironment</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token maybe-class-name" style="color:#00bfff">EnvironmentRecord</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token maybe-class-name" style="color:#00bfff">Type</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&quot;Declarative&quot;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token comment" style="color:#737373">// 函数环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token comment" style="color:#737373">// ... 标识符绑定在这⾥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token comment" style="color:#737373">// 对全局环境或外部函数环境的引⽤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      outer</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token maybe-class-name" style="color:#00bfff">Global</span><span class="token plain"> or outer </span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> environment reference</span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>为了继续去适配早期的 JS 的 var 等，新的规范增加了变量环境（VariableEnvironment）。变量环境也是⼀个词法环境，其环境记录器包含了由变量声明语句</p><p>在ES6 中，词法环境组件和变量环境组件的区别在与前者⽤于存储函数声明和变量<span style="color:red">（ let 和 const ）</span>绑定，⽽后者仅⽤与存储变量<span style="color:red">（ var ）</span>绑定。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token keyword" style="color:#FF69B4">let</span><span class="token plain"> a </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">20</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">const</span><span class="token plain"> b </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">30</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> c</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token keyword" style="color:#FF69B4">function</span><span class="token plain"> </span><span class="token function" style="color:#00E673">multiply</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token parameter" style="color:#FFB86C">e</span><span class="token parameter punctuation" style="color:#FF69B4">,</span><span class="token parameter" style="color:#FFB86C"> f</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword" style="color:#FF69B4">var</span><span class="token plain"> g </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">20</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#FF69B4">return</span><span class="token plain"> e</span><span class="token operator" style="color:#FF69B4">*</span><span class="token plain">f</span><span class="token operator" style="color:#FF69B4">*</span><span class="token plain">g</span><span class="token punctuation" style="color:#FF69B4">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">c </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token function" style="color:#00E673">multiply</span><span class="token punctuation" style="color:#FF69B4">(</span><span class="token number" style="color:#BD93F9">20</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">30</span><span class="token punctuation" style="color:#FF69B4">)</span><span class="token punctuation" style="color:#FF69B4">;</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>词法组成</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#dddddd;background-color:#24272a"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#dddddd"><span class="token comment" style="color:#737373">// 全局执⾏上下⽂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token maybe-class-name" style="color:#00bfff">GlobalExectionContext</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">ThisBinding</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:#00bfff">Global</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#00bfff">Object</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token comment" style="color:#737373">// 词法环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">LexicalEnvironment</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token maybe-class-name" style="color:#00bfff">EnvironmentRecord</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token maybe-class-name" style="color:#00bfff">Type</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&quot;Object&quot;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token comment" style="color:#737373">// 标识符绑定，let、const、函数声明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      a</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> uninitialized </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      b</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> uninitialized </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      multiply</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> func </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    outer</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#FF69B4">null</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token comment" style="color:#737373">// 变量环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">VariableEnvironment</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token maybe-class-name" style="color:#00bfff">EnvironmentRecord</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token maybe-class-name" style="color:#00bfff">Type</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&quot;Object&quot;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token comment" style="color:#737373">// 标识符绑定，var 声明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      c</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#FF69B4">undefined</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    outer</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#FF69B4">null</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token comment" style="color:#737373">// 函数执⾏上下⽂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token maybe-class-name" style="color:#00bfff">FunctionExectionContext</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">ThisBinding</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:#00bfff">Global</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#00bfff">Object</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">LexicalEnvironment</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token maybe-class-name" style="color:#00bfff">EnvironmentRecord</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token maybe-class-name" style="color:#00bfff">Type</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&quot;Declarative&quot;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token comment" style="color:#737373">// 标识符绑定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token maybe-class-name" style="color:#00bfff">Arguments</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">        </span><span class="token number" style="color:#BD93F9">0</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">20</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">        </span><span class="token number" style="color:#BD93F9">1</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">30</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">        length</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token number" style="color:#BD93F9">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    outer</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:#00bfff">GlobalLexicalEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token maybe-class-name" style="color:#00bfff">VariableEnvironment</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token maybe-class-name" style="color:#00bfff">EnvironmentRecord</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#FF69B4">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token maybe-class-name" style="color:#00bfff">Type</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token string" style="color:#C3E88D">&quot;Declarative&quot;</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      </span><span class="token comment" style="color:#737373">// 在这⾥绑定标识符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">      g</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#FF69B4">undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token punctuation" style="color:#FF69B4">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">    outer</span><span class="token operator" style="color:#FF69B4">:</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&lt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:#00bfff">GlobalLexicalEnvironment</span><span class="token plain"> </span><span class="token operator" style="color:#FF69B4">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain">  </span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain"></span><span class="token punctuation" style="color:#FF69B4">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dddddd"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>以上 let 和 const 定义的变量并没有关联任何值 uninitialized(未初始化) ，但 var 定义的变量被初始化成 undefined 。这也就是造成<span style="color:red"> TDZ(临时性死区 Temporal Dead Zone) </span>的原因了。</p><p>接下来就是执⾏阶段，完成对所有变量的分配，最后执⾏代码。⽆论是 ES3 还是 ES5,上下⽂的⽣命周期包括三个阶段：创建阶段 -&gt; 执⾏阶段 -&gt; 回收阶段。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>js 作用域</h5></div><div class="admonition-content"><p>  函数级词法作用域</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="参考链接">参考链接<a aria-hidden="true" class="hash-link" href="#参考链接" title="标题的直接链接">​</a></h2><p><a href="https://blog.csdn.net/dhassa/article/details/70945016" target="_blank" rel="noopener noreferrer">图解JS词法环境(Lexical environment)</a></p><p><a href="https://stackoverflow.com/questions/23948198/variable-environment-vs-lexical-environment/54673945" target="_blank" rel="noopener noreferrer">variable-environment-vs-lexical-environment</a></p><p><a href="https://tc39.es/ecma262/#sec-environment-records" target="_blank" rel="noopener noreferrer">ecma262</a></p><p><a href="https://lilixikun.github.io/blog/js/%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B.html#%E6%89%A7%E8%A1%8C%E5%A0%86%E6%A0%88" target="_blank" rel="noopener noreferrer">xikun&#x27;s blog</a></p><p><a href="https://segmentfault.com/a/1190000000533094" target="_blank" rel="noopener noreferrer">javascript 执行环境，变量对象，作用域链</a></p><p><a href="https://segmentfault.com/a/1190000009041008" target="_blank" rel="noopener noreferrer">深入理解JavaScript执行上下文、函数堆栈、提升的概念</a></p><p><a href="https://github.com/goddyZhao/Translation/tree/master/JavaScript" target="_blank" rel="noopener noreferrer">翻译文档</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Functions" target="_blank" rel="noopener noreferrer">Functions MDN</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/HondryTravis/Blog/tree/master/packages/docs/typescript/javascript_workflow.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">最后<!-- -->由 <b>travis</b> <!-- -->于 <b><time datetime="2022-12-06T11:14:09.000Z">2022/12/6</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/typescript/recursive_optimization"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">« <!-- -->JS | 函数递归优化</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/typescript/u_dont_know_js"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">JS | 你知道的JS<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#关键词" class="table-of-contents__link toc-highlight">关键词</a></li><li><a href="#执栈" class="table-of-contents__link toc-highlight">执⾏栈</a></li><li><a href="#全局对象" class="table-of-contents__link toc-highlight">全局对象</a></li><li><a href="#变量对象" class="table-of-contents__link toc-highlight">变量对象</a></li><li><a href="#活动对象" class="table-of-contents__link toc-highlight">活动对象</a></li><li><a href="#深度活动对象" class="table-of-contents__link toc-highlight">深度活动对象</a></li><li><a href="#补充活动对象" class="table-of-contents__link toc-highlight">补充活动对象</a></li><li><a href="#发生异步" class="table-of-contents__link toc-highlight">发生异步</a></li><li><a href="#新版本-es5" class="table-of-contents__link toc-highlight">新版本 ES5+</a><ul><li><a href="#确定thisbinding" class="table-of-contents__link toc-highlight">确定ThisBinding</a></li><li><a href="#词法环境" class="table-of-contents__link toc-highlight">词法环境</a></li></ul></li><li><a href="#参考链接" class="table-of-contents__link toc-highlight">参考链接</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">快速了解</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/performance/page_performance_index">如何监控页面性能指标</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/thinking/design_patterns">设计模式</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/thinking/functional_programming">函数式编程</a></li></ul></div><div class="col footer__col"><div class="footer__title">学习</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/algorithm/">算法</a></li></ul></div><div class="col footer__col"><div class="footer__title">开源贡献</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/open_source/cli/tscli">tscli</a></li><li class="footer__item"><a class="footer__link-item" href="/open_source/github/indexeddb">Indexeddb</a></li><li class="footer__item"><a class="footer__link-item" href="/open_source/github/tinydb_docapi">TinyDB</a></li><li class="footer__item"><a class="footer__link-item" href="/open_source/vscode/Simple-dark">Simple dark</a></li><li class="footer__item"><a href="https://github.com/HondryTravis/xs-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>xs-doc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/myliang/x-spreadsheet" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>x-spreadsheet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">联系方式</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contact">邮箱 | 联系方式</a></li></ul></div><div class="col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items"><li class="footer__item"><a href="https://kalacloud.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>卡拉云低代码工具<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">AGPL-3.0 Licensed | Copyright © 2020-present HondryTravis, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.261a0b30.js"></script>
<script src="/assets/js/main.d8aec2c2.js"></script>
</body>
</html>